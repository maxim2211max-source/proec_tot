import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import joblib
from io import StringIO, BytesIO
import sklearn
sklearn.set_config(transform_output="pandas")
from sklearn.pipeline import Pipeline, make_pipeline
from sklearn.preprocessing import StandardScaler, OneHotEncoder, RobustScaler, MinMaxScaler, OrdinalEncoder, TargetEncoder
from sklearn.compose import ColumnTransformer
from sklearn.model_selection import cross_val_score
from sklearn.impute import SimpleImputer

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –Ω–∞—á–∞–ª–µ!)
st.set_page_config(page_title="–ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ–º–∞", layout="wide")

st.title("–ê–Ω–∞–ª–∏–∑ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ House Prices")

tab1, tab1i3i4, tab2, tab3, tab4 = st.tabs(["–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞", "–ü–µ—Ä–≤–∞—è –º–æ–¥–µ–ª—å", "–í—Ç–æ—Ä–∞—è –º–æ–¥–µ–ª—å", "–¢—Ä–µ—Ç—å—è –º–æ–¥–µ–ª—å", "–ò—Ç–æ–≥–∏"])

with tab1:
    st.header("–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞")
    # –ü–æ–º–µ–Ω—è–π—Ç–µ –ø—É—Ç—å !! –≤–Ω–∏–º–∞—Ç!
    try:
        df_train = pd.read_csv("/home/adminadmin/–ó–∞–≥—Ä—É–∑–∫–∏/house-prices-advanced-regression-techniques/train.csv")
        df_test = pd.read_csv("/home/adminadmin/–ó–∞–≥—Ä—É–∑–∫–∏/house-prices-advanced-regression-techniques/test.csv")
    except FileNotFoundError:
        st.error("–§–∞–π–ª—ã train.csv –∏–ª–∏ test.csv –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å.")

    df_numeric = df_train.select_dtypes(include=['float64', 'int64']) 
    corr = df_numeric.corr()

    fig, ax = plt.subplots(figsize=(24, 12))
    sns.heatmap(corr, annot=True, fmt=".2f", cmap="coolwarm", ax=ax)
    st.pyplot(fig)

    if 'SalePrice' in df_numeric.columns:
        mask = abs(corr['SalePrice']) > 0.32
        features = corr[mask].index.drop('SalePrice')
        import_feature_1 = sorted(features.to_list())

        st.write(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–∏–º—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: {len(import_feature_1)}")
        st.write(f"–ò—Å—Ö–æ–¥—è –∏–∑ —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã –∫–∞–∂—É—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ –∑–Ω–∞—á–∏–º—ã–º–∏ —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏: {'\", \"'.join(import_feature_1)}")
    else:
        st.error("–°—Ç–æ–ª–±–µ—Ü SalePrice –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –¥–∞–Ω–Ω—ã—Ö.")

with tab1i3i4:
    st.title("üè† –ü—Ä–æ–±–Ω–∞—è –º–æ–¥–µ–ª—å: –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏")
    st.write("–ü–µ—Ä–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è")

    col1, col2, col3 = st.columns(3)

    with col1:
        with st.expander("üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö", expanded=True):
            st.markdown("""
            * **–ü—Ä–æ–ø—É—Å–∫–∏ >80%**: 
                –£–¥–∞–ª–µ–Ω–∏–µ 4—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:
            - `Alley`
            - `PoolQC` 
            - `Fence`
            - `MiscFeature`
            * **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–æ–ø—É—Å–∫–∏**: 
            - –°—Ä–µ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
            - –ú–æ–¥–æ–π
            - –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏
            * **–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ**: 
                - One Hot Encoder
            * **–ù–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ**:
            - –° –≤—ã–±—Ä–æ—Å–∞–º–∏: Robust Scaler
            - –ë–µ–∑ –≤—ã–±—Ä–æ—Å–æ–≤: Standard Scaler
            """)

    with col2:
        with st.expander("ü§ñ –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏", expanded=True):
            st.markdown("""
            **–ú–æ–¥–µ–ª—å**: –ê–Ω—Å–∞–º–±–ª—å Voting –∏–∑:
            * XGBRegressor
            * Ridge
            """)

    with col3:
        with st.expander("‚≠ê –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏", expanded=True):
            st.markdown("""
            * –õ–æ–≥–∞—Ä–∏—Ñ–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π 
                        –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
            * –†–∞—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫ –ø–æ—Å–ª–µ 
                        cross-valid
            * 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ scoring:
            - r2
            - neg_mean_
                    squared_error
            """)

    st.subheader('üìà –ò—Ç–æ–≥–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:')

    metric_col1, metric_col2, metric_col3, metric_col4 = st.columns(4)

    with metric_col1:
        st.metric(label="–ø—Ä–∏ r2 Mean", value="0.8971", delta=None)

    with metric_col2:
        st.metric(label="–ø—Ä–∏ r2 Std", value="0.01853", delta=None)

    with metric_col3:
        st.metric(label="–ø—Ä–∏ MSE Mean", value="0.01649", delta=None)

    with metric_col4:
        st.metric(label="–ø—Ä–∏ MSE Std", value="0.00370", delta=None)

    st.divider()

with tab2:
    st.write("–í –ø–æ–ø—ã—Ç–∫–µ —É–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏, –±—ã–ª–∞ –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–∞ –ø–æ–ø—ã—Ç–∫–∞ –æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ–ª–∏ –±–æ–ª—å—à–∏–π –≤–µ—Å –≤ —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç–µ. –ü—Ä–∏–∑–Ω–∞–∫–∏ –≤—ã–±–∏—Ä–∞–ª–∏ –∏—Å—Ö–æ–¥—è –∏–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –ü–∏—Ä—Å–æ–Ω–∞.")
    st.write("–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—É—á–∏–ª–∏—Å—å —Å–ª–µ–¥—É—é—â–∏–º–∏")
    
    st.markdown("""
    **–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ü–∏—Ä—Å–æ–Ω–∞ (r)** ‚Äî —ç—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –º–µ—Ä–∞, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è —Å–∏–ª—É –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–Ω–µ–π–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏.
    """)
    
    st.markdown("""
    - **–°—Ä–µ–¥–Ω–µ–µ R¬≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏**: 0.8523  
    - **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ R¬≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏**: 0.02444  
    - **–°—Ä–µ–¥–Ω–µ–µ MSE –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏**: 0.0234  
    - **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ MSE –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏**: 0.0042  
    """)

    st.write("–í —Å–≤—è–∑–∏ —Å —Ç–µ–º, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–¥–µ–ª–∏ –ø–æ–ª—É—á–∏–ª—Å—è –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–º, –æ—Ç —ç—Ç–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –±—ã–ª–æ —Ä–µ—à–µ–Ω–æ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è.")

with tab3:
    st.write("–ù–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ Permutation importance. ")
    st.write("–ú—ã —Ä–µ—à–∏–ª–∏ –æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ Permutation importance, —Ç–∞–∫ –∏ —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã.")
    st.write("–ë—ã–ª–∏ –≤—ã—è–≤–ª–µ–Ω—ã 11 –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: '1stFlrSF', 'BsmtFinSF1', 'Fireplaces', 'GarageArea','GarageCars','GrLivArea', 'LotFrontage', 'OverallQual', 'TotalBsmtSF', 'YearBuilt', 'YearRemodAdd'.")
    st.write("–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—É—á–∏–ª–∏—Å—å —Å–ª–µ–¥—É—é—â–∏–º–∏:")

    st.markdown("""
    ### –ú–µ—Ç—Ä–∏–∫–∏ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è 11 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    
    | –ú–µ—Ç—Ä–∏–∫–∞                          | –ó–Ω–∞—á–µ–Ω–∏–µ          |
    |----------------------------------|-------------------|
    | –°—Ä–µ–¥–Ω–µ–µ R¬≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏       | 0.8527            |
    | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ R¬≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ | 0.0243    |
    | –°—Ä–µ–¥–Ω–µ–µ MSE –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏      | 0.0234            |
    | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ MSE –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ | 0.0042  |
    """)

    st.write("–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ.")

with tab4:
    st.write("–û–±—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π —Å–ª–µ–¥—É—é—â–∏–µ:")

    # –¢–∞–±–ª–∏—Ü—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å)
    st.markdown("""
    ### –ú–µ—Ç—Ä–∏–∫–∏ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è 16 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

    | –ú–µ—Ç—Ä–∏–∫–∞                          | –ó–Ω–∞—á–µ–Ω–∏–µ          |
    |----------------------------------|-------------------|
    | –°—Ä–µ–¥–Ω–µ–µ R¬≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏       | 0.8524            |
    | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ R¬≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ | 0.0245    |
    | –°—Ä–µ–¥–Ω–µ–µ MSE –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏      | 0.0235            |
    | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ MSE –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ | 0.0043  |
    """)
    
    st.markdown("""
    ### –ú–µ—Ç—Ä–∏–∫–∏ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

    | –ú–µ—Ç—Ä–∏–∫–∞                          | –ó–Ω–∞—á–µ–Ω–∏–µ          |
    |----------------------------------|-------------------|
    | –°—Ä–µ–¥–Ω–µ–µ R¬≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏       | 0.8968            |
    | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ R¬≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ | 0.0184    |
    | –°—Ä–µ–¥–Ω–µ–µ MSE –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏      | 0.0165            |
    | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ MSE –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ | 0.0037  |
    """)
    
    st.markdown("""
    ### –ú–µ—Ç—Ä–∏–∫–∏ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è 11 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

    | –ú–µ—Ç—Ä–∏–∫–∞                          | –ó–Ω–∞—á–µ–Ω–∏–µ          |
    |----------------------------------|-------------------|
    | –°—Ä–µ–¥–Ω–µ–µ R¬≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏       | 0.8527            |
    | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ R¬≤ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ | 0.0243    |
    | –°—Ä–µ–¥–Ω–µ–µ MSE –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏      | 0.0234            |
    | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ MSE –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ | 0.0042  |
    """)

    st.write("–ö–∞–∫ –º—ã –≤–∏–¥–∏–º, –ª—É—á—à–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö. –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –∏–º–µ—é—Ç –±–æ–ª—å—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ–∫–∞–∑–∞–ª–æ—Å—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è. –ú–µ–Ω–µ–µ –∑–Ω–∞—á–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏ —Ç–∞–∫–∂–µ –∏–≥—Ä–∞—é—Ç –≤–∞–∂–Ω—É—é —Ä–æ–ª—å.")
    
    import streamlit as st
import pandas as pd
import joblib
from io import BytesIO
import numpy as np

st.divider()  # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –ø–µ—Ä–µ–¥ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è–º–∏

# –†–∞–∑–¥–µ–ª –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π (–∑–¥–µ—Å—å "–≤–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–∞" - –∑–∞–≥—Ä—É–∑–∫–∞ CSV)
with st.expander("üè† –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏", expanded=True):
    st.write("–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è.")
    
    # –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
    try:
        model = joblib.load('full_pipeline.joblib')  # –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å
        st.success("–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
        model_loaded = True
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏: {e}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é sklearn –∏–ª–∏ –ø–µ—Ä–µ–æ–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å.")
        model_loaded = False
    
    if model_loaded:
        # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–¥–µ—Å—å –∫–ª—é—á–µ–≤–æ–π –∫–æ–¥ –¥–ª—è "–≤–ª–æ–∂–µ–Ω–∏—è —Ñ–∞–π–ª–∞")
        uploaded_file = st.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Ñ–∞–π–ª", type='csv')
        
        if uploaded_file:
            df = pd.read_csv(uploaded_file)
            st.write("–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö:")
            st.dataframe(df.head())
            
            # –í–∞–∂–Ω–æ: —Å–æ—Ö—Ä–∞–Ω—è–µ–º Id –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            if 'Id' in df.columns:
                ids = df['Id'].copy()
            
            if st.button('–ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å'):
                try:
                    # –ö–ª—é—á–µ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                    
                    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
                    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞–µ–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –∏–∑ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
                    # (–¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –±—ã–ª–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–ª–æ–Ω–∫–∞—Ö –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏)
                    
                    # 2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –ø–∞–π–ø–ª–∞–π–Ω
                    predictions = model.predict(df)
                    
                    # 3. –°–æ–∑–¥–∞–µ–º DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
                    result_df = pd.DataFrame({
                        'Id': ids if 'Id' in df.columns else range(1, len(predictions) + 1),
                        '–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω–∞—è_—Å—Ç–æ–∏–º–æ—Å—Ç—å': predictions
                    })
                    
                    st.write("–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π:")
                    st.dataframe(result_df)
                    
                    # –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    col1, col2, col3 = st.columns(3)
                    with col1:
                        st.metric("–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞", f"${predictions.min():,.2f}")
                    with col2:
                        st.metric("–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞", f"${predictions.mean():,.2f}")
                    with col3:
                        st.metric("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞", f"${predictions.max():,.2f}")
                    
                    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    csv_buffer = BytesIO()
                    result_df.to_csv(csv_buffer, index=False, encoding='utf-8')
                    csv_data = csv_buffer.getvalue()
                    
                    st.download_button(
                        label="üì• –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ CSV",
                        data=csv_data,
                        file_name="house_price_predictions.csv",
                        mime="text/csv",
                        key="download_results"
                    )
                    
                except Exception as e:
                    st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–∏: {str(e)}")
                    
                    # –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                    with st.expander("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏"):
                        st.write(f"–¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
                        st.write("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ:")
                        st.write("1. CSV —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–µ –∂–µ –∫–æ–ª–æ–Ω–∫–∏, —á—Ç–æ –∏ train.csv (–∫—Ä–æ–º–µ SalePrice)")
                        st.write("2. –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ")
                        st.write("3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–ª–æ–Ω–∫–∞—Ö")
                        
                    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                    st.write("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:")
                    st.write(f"–ö–æ–ª–æ–Ω–∫–∏: {df.columns.tolist()}")
                    st.write(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: {len(df)}")
                    st.write(f"–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö: {df.dtypes.to_dict()}")
    else:
        st.warning("–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ –º–æ–¥–µ–ª–∏.")